<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <style>
    @page {
      size: A4 portrait;
      margin: 8mm;
    }

    body {
      font-family: Arial, sans-serif;
      font-size: 10px;
      line-height: 1.3;
      margin: 0;
      padding: 0;
      background: white;
    }

    .logo {
      text-align: left;
      margin-bottom: 5px;
    }

    h3 {
      font-size: 14px;
      text-align: center;
      margin: 5px 0 10px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 8px;
      page-break-inside: avoid;
    }

    th, td {
      border: 1px solid #000;
      padding: 4px;
      font-size: 10px;
      vertical-align: top;
    }

    .bold {
      font-weight: bold;
    }

    .center {
      text-align: center;
    }

    .left {
      text-align: left;
    }

    .col-left {
      text-align: left;
    }

    .col-center {
      text-align: center;
    }

    .assinatura td {
      border: none;
      height: 100px;
      vertical-align: bottom;
      padding-top: 10px;
    }

    .assinatura-label {
      font-weight: bold;
      display: block;
      margin-bottom: 6px;
    }

    .assinatura-linha {
      display: block;
      border-top: 1px solid #000;
      width: 100%;
      margin-top: 35px;
    }

    .sub-label {
      font-size: 9px;
      font-style: italic;
      color: #333;
    }

    .page-break {
      page-break-after: always;
    }
  </style>
</head>
<body>

{% macro format_text(value) %}
  {% if value is not none and value != 'None' and value != 'N/A' %}{{ value }}{% else %}{{ '' }}{% endif %}
{% endmacro %}
{% macro format_currency(value) %}
  {% if value is not none and value != 0 %}R$ {{ '%.2f' | format(value) }}{% else %}{{ '' }}{% endif %}
{% endmacro %}
{% macro format_qtd(value) %}
  {% if value is not none and value != 0 %}{{ value }}{% else %}{{ '' }}{% endif %}
{% endmacro %}

{% for r in registros %}
  <div class="logo">
    <img src="data:image/png;base64,{{ logo_base64 }}" alt="Logo" style="height: 50px;">
  </div>

  <h3>Relatório de Auditoria Hospitalar</h3>

  <table>
    <tr><td class="bold">Título:</td><td colspan="3">RAH - Relatório de Auditoria Hospitalar</td><td class="bold">Fase:</td><td>Aprovado</td></tr>
    <tr><td class="bold">Tipo de Anexo:</td><td colspan="5">Registro</td></tr>
    <tr><td class="bold">Número e Versão do Anexo:</td><td colspan="5">RGQ-0146 - V.0</td></tr>
  </table>

  <table>
    <tr><td colspan="2"><strong>Nome Prestador:</strong><br>{{ format_text(r.nome_prestador) }}</td><td colspan="2"><strong>Código Prestador:</strong><br>{{ format_text(r.cod_prestador) }}</td></tr>
    <tr><td colspan="2"><strong>Nome do Beneficiário:</strong><br>{{ format_text(r.nome_beneficiario) }}</td><td colspan="2"><strong>Código Beneficiário:</strong><br>{{ format_text(r.cod_beneficiario) }}</td></tr>
    <tr><td colspan="2"><strong>Nº guia principal:</strong><br>{{ format_text(r.guia_principal) }}</td><td colspan="2"><strong>Data da auditoria:</strong><br>{{ format_text(r.data_auditoria_br) }}</td></tr>
    <tr><td colspan="2"><strong>Data e hora internação:</strong><br>{{ format_text(r.data_internacao_br) }}</td><td colspan="2"><strong>Data e hora alta:</strong><br>{{ format_text(r.data_alta_br) }}</td></tr>
    <tr><td><strong>Tipo internação:</strong><br>{{ format_text(r.tipo_internacao) }}</td><td><strong>Caráter internação:</strong><br>{{ format_text(r.caracter_internacao) }}</td><td><strong>Parcial:</strong><br>{{ format_text(r.parcial) }}</td></tr>
    <tr><td colspan="3"><strong>Período da fatura:</strong><br>{{ format_text(r.fatura_de_br) }} a {{ format_text(r.fatura_ate_br) }}</td></tr>
    <tr><td><strong>Cód. Proced. principal:</strong><br>{{ format_text(r.cod_procedimento) }}</td><td><strong>Descrição procedimento principal:</strong><br>{{ format_text(r.descricao_procedimento) }}</td><td><strong>CID diagnóstico principal:</strong><br>{{ format_text(r.cid_codigo) }}</td></tr>
  </table>

  <table>
    <thead>
      <tr class="center bold">
        <td rowspan="2">Grupo de despesas</td>
        <td colspan="2">Quantidade (diárias)</td>
        <td rowspan="2">Valor apresentado (R$)</td>
        <td rowspan="2">Valor glosa médica (R$)</td>
        <td rowspan="2">Valor glosa enfermagem (R$)</td>
        <td rowspan="2">Valor liberado (R$)</td>
      </tr>
      <tr class="center bold">
        <td class="sub-label">Quantidade apresentada</td>
        <td class="sub-label">Quantidade autorizada</td>
      </tr>
    </thead>
    <tbody>
      {% for i in range(1, 11) %}
        {% set grupo = r['grupo_' ~ i] %}
        {% set qtd_apresentada = r['qtd_apresentada_' ~ i] %}
        {% set qtd_autorizada = r['qtd_autorizada_' ~ i] %}
        {% set va = r['valor_apresentado_' ~ i] %}
        {% set gm = r['glosa_medico_' ~ i] %}
        {% set ge = r['glosa_enfermagem_' ~ i] %}
        {% set vl = r['valor_liberado_' ~ i] %}
        {% if grupo or va or gm or ge or vl or qtd_apresentada or qtd_autorizada %}
        <tr>
          <td class="col-left">{{ format_text(grupo) }}</td>
          <td class="col-center">{{ format_qtd(qtd_apresentada) }}</td>
          <td class="col-center">{{ format_qtd(qtd_autorizada) }}</td>
          <td class="col-left">{{ format_currency(va) }}</td>
          <td class="col-left" style="color: red">{{ format_currency(gm) }}</td>
          <td class="col-left" style="color: red">{{ format_currency(ge) }}</td>
          <td class="col-left">{{ format_currency(vl) }}</td>
        </tr>
        {% endif %}
      {% endfor %}
    </tbody>
  </table>

  <p><strong>* N/A - Não se aplica</strong></p>

  <table class="assinatura">
    <tr>
      <td>
        <strong>De acordo Auditoria/Faturamento Prestador:</strong><br>
        Data: {{ format_text(r.data_registro_br) }}<br><br>
        Assinatura e carimbo: ________________________________
      </td>
      <td>
        <strong>Auditoria Operadora:</strong><br>
        Data: {{ format_text(r.data_registro_br) }}<br>
        Médico Auditor:<br>
        Assinatura e carimbo: ________________________________<br><br><br><br>
        Enfermeiro Auditor:<br>
        Assinatura e carimbo: ________________________________
      </td>
    </tr>
  </table>

  {% if not loop.last %}<div class="page-break"></div>{% endif %}
{% endfor %}

</body>
</html>
